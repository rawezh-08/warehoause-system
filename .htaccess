# Secure directory structure
Options -Indexes

# Deny access to sensitive files
<FilesMatch "^(\.htaccess|\.htpasswd|config\.php|database\.php)$">
    Order Deny,Allow
    Deny from all
</FilesMatch>

# Set default character set
AddDefaultCharset UTF-8

# Enable rewriting
RewriteEngine On
RewriteBase /warehouse-system/

# Handle case-insensitive URLs
RewriteMap lc int:tolower
RewriteCond %{REQUEST_URI} [A-Z]
RewriteRule (.*) ${lc:$1} [R=301,L]

# Ensure PHP files are processed as PHP
<FilesMatch "\.php$">
    SetHandler application/x-httpd-php
</FilesMatch>

# Allow access to controllers directory
<Directory "/var/www/html/warehoause-system/Selling-System/src/controllers">
    Options +FollowSymLinks
    AllowOverride All
    Require all granted
</Directory>

# Allow access to assets and necessary public files
RewriteCond %{REQUEST_URI} !^/warehouse-system/(index\.php|logout\.php)
RewriteCond %{REQUEST_URI} !^/warehouse-system/Selling-System/src/(assets|css|js|uploads|controllers)/

# Special rule for views - must have a valid session
RewriteCond %{REQUEST_URI} ^/warehouse-system/Selling-System/src/views/
RewriteCond %{REQUEST_FILENAME} -f
RewriteCond %{REQUEST_URI} \.php$
RewriteRule ^ - [L]

# PHP settings for security
php_flag session.cookie_httponly on
php_flag session.use_only_cookies on 